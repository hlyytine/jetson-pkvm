<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1616px" preserveAspectRatio="none" style="width:763px;height:1616px;background:#FEFEFE;" version="1.1" viewBox="0 0 763 1616" width="763px" zoomAndPan="magnify"><defs><filter height="300%" id="f1tf418tfu64r3" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="206" x="282" y="19.2419">Autopilot State Machine</text><ellipse cx="564" cy="219.0158" fill="#000000" filter="url(#f1tf418tfu64r3)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#CCE5FF" filter="url(#f1tf418tfu64r3)" height="115.3396" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="102" x="515" y="355.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="515" x2="617" y1="460.8554" y2="460.8554"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="536" y="375.4818">STARTUP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="558.5" y="394.5497">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="525" y="413.6176">board.boot()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="530.5" y="432.6855">extlinux '1'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="537" y="451.7534">wait SSH</text><rect fill="#D4EDDA" filter="url(#f1tf418tfu64r3)" height="96.2717" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="135" x="221.5" y="880.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="221.5" x2="356.5" y1="966.7875" y2="966.7875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="267" y="900.4818">READY</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="281.5" y="919.5497">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="231.5" y="938.6176">5.15.148 running</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="239.5" y="957.6855">SSH accessible</text><rect fill="#FFCCCC" filter="url(#f1tf418tfu64r3)" height="96.2717" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="103" x="313.5" y="549.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="313.5" x2="416.5" y1="635.7875" y2="635.7875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="335.5" y="569.4818">MANUAL</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="357.5" y="588.5497">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="323.5" y="607.6176">Intervention</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="334" y="626.6855">Required</text><rect fill="#FFF3CD" filter="url(#f1tf418tfu64r3)" height="77.2038" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="91" x="243.5" y="1055.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="243.5" x2="334.5" y1="1122.7196" y2="1122.7196"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="261.5" y="1075.4818">UPLOAD</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="281.5" y="1094.5497">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="253.5" y="1113.6176">SCP kernel</text><rect fill="#FFF3CD" filter="url(#f1tf418tfu64r3)" height="77.2038" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="94" x="319" y="1211.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="319" x2="413" y1="1278.7196" y2="1278.7196"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="338" y="1231.4818">REBOOT</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="358.5" y="1250.5497">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="329" y="1269.6176">SSH reboot</text><rect fill="#F8D7DA" filter="url(#f1tf418tfu64r3)" height="77.2038" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="120" x="220" y="1525.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="220" x2="340" y1="1592.7196" y2="1592.7196"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="257" y="1545.4818">FAILED</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="272.5" y="1564.5497">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="230" y="1583.6176">Move to failed/</text><rect fill="#FFF3CD" filter="url(#f1tf418tfu64r3)" height="77.2038" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="107" x="317.5" y="1367.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="317.5" x2="424.5" y1="1434.7196" y2="1434.7196"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="327.5" y="1387.4818">PANIC_BOOT</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="363.5" y="1406.5497">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="335.5" y="1425.6176">extlinux '2'</text><rect fill="#FFE5CC" filter="url(#f1tf418tfu64r3)" height="77.2038" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="113" x="597.5" y="1525.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="597.5" x2="710.5" y1="1592.7196" y2="1592.7196"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="612.5" y="1545.4818">PANIC_WAIT</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="646.5" y="1564.5497">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="607.5" y="1583.6176">Monitor UART</text><rect fill="#333333" filter="url(#f1tf418tfu64r3)" height="50" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="56" x="202" y="32.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="202" x2="258" y1="61.5838" y2="61.5838"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="212" y="52.4818">FORK</text><rect fill="#CCE5FF" filter="url(#f1tf418tfu64r3)" height="115.3396" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="102" x="6" y="355.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="6" x2="108" y1="460.8554" y2="460.8554"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="22" y="375.4818">RECOVERY</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="30.5" y="394.5497">(thread)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="49.5" y="413.6176">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="16" y="432.6855">board.boot()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="28" y="451.7534">wait SSH</text><rect fill="#E2D5F1" filter="url(#f1tf418tfu64r3)" height="115.3396" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="103" x="178.5" y="161.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="178.5" x2="281.5" y1="266.8554" y2="266.8554"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="191" y="181.4818">LOG_FILTER</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="209" y="200.5497">(main)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="222.5" y="219.6176">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="189.5" y="238.6855">filter scripts</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="188.5" y="257.7534">disassembly</text><rect fill="#D4EDDA" filter="url(#f1tf418tfu64r3)" height="96.2717" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="153" x="143.5" y="365.0158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="143.5" x2="296.5" y1="451.2875" y2="451.2875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="184" y="384.9818">COMPLETE</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="212.5" y="404.0497">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="153.5" y="423.1176">Move to completed/</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="172.5" y="442.1855">Results ready!</text><rect fill="#333333" filter="url(#f1tf418tfu64r3)" height="50" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="51" x="194.5" y="572.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="194.5" x2="245.5" y1="601.5838" y2="601.5838"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="204.5" y="592.4818">JOIN</text><rect fill="#CCE5FF" filter="url(#f1tf418tfu64r3)" height="77.2038" rx="12.5" ry="12.5" style="stroke: #333333; stroke-width: 1.5;" width="94" x="242" y="724.5158"/><line style="stroke: #333333; stroke-width: 1.5;" x1="242" x2="336" y1="791.7196" y2="791.7196"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="271.5" y="744.4818">WAIT</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="15" x="281.5" y="763.5497">---</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="252" y="782.6176">join thread</text><path d="M293,35.0158 L293,53.5158 L258.21,57.5158 L293,61.5158 L293,80.4279 A0,0 0 0 0 293,80.4279 L437,80.4279 A0,0 0 0 0 437,80.4279 L437,45.0158 L427,35.0158 L293,35.0158 A0,0 0 0 0 293,35.0158 " fill="#FBFB77" filter="url(#f1tf418tfu64r3)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M427,35.0158 L427,45.0158 L437,45.0158 L427,35.0158 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="299" y="53.9129">Thread starts first,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="299" y="71.6189">then main continues</text><path d="M331.5,390.5158 L331.5,409.0158 L296.65,413.0158 L331.5,417.0158 L331.5,435.9279 A0,0 0 0 0 331.5,435.9279 L480.5,435.9279 A0,0 0 0 0 480.5,435.9279 L480.5,400.5158 L470.5,390.5158 L331.5,390.5158 A0,0 0 0 0 331.5,390.5158 " fill="#FBFB77" filter="url(#f1tf418tfu64r3)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M470.5,390.5158 L470.5,400.5158 L480.5,400.5158 L470.5,390.5158 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="337.5" y="409.4129">User sees results</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="337.5" y="427.1189">before recovery done</text><path d="M406,1523.5158 L406,1604.3399 A0,0 0 0 0 406,1604.3399 L562,1604.3399 A0,0 0 0 0 562,1604.3399 L562,1568.0158 L597.24,1564.0158 L562,1560.0158 L562,1533.5158 L552,1523.5158 L406,1523.5158 A0,0 0 0 0 406,1523.5158 " fill="#FBFB77" filter="url(#f1tf418tfu64r3)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M552,1523.5158 L552,1533.5158 L562,1533.5158 L552,1523.5158 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="412" y="1542.4129">Detects:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="412" y="1560.1189">panic, smmu_fault,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="412" y="1577.8249">nvgpu_acr_fail,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="412" y="1595.5309">bash_prompt, timeout</text><!--MD5=[39c594443d5c7f739634c04fe79bb73a]
link *start to STARTUP--><path d="M563.39,229.0458 C562.25,247.2858 559.97,289.7958 561,325.5158 C561.23,333.4858 561.58,341.8658 561.99,350.1358 " fill="none" id="*start-&gt;STARTUP" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="562.25,355.2658,565.7811,346.0718,561.9925,350.2725,557.7917,346.4838,562.25,355.2658" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="562" y="321.4129">daemon start</text><!--MD5=[7a3088abe3c56411335957c71f8498b7]
link STARTUP to READY--><path d="M537.42,470.5558 C529.29,486.4358 520.37,503.6958 512,519.5158 C443.8,648.4158 360.81,798.5658 317.86,875.7858 " fill="none" id="STARTUP-&gt;READY" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="315.34,880.3158,323.2074,874.391,317.7682,875.9451,316.2142,870.5059,315.34,880.3158" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="426" y="690.4129">SSH prompt</text><!--MD5=[b7800c5b993c06317d58918074f08efe]
link STARTUP to MANUAL--><path d="M514.98,456.8658 C509.29,461.5158 503.54,466.1358 498,470.5158 C480.56,484.2858 474.67,485.8258 458,500.5158 C442.27,514.3758 426.06,530.4058 411.67,545.3558 " fill="none" id="STARTUP-&gt;MANUAL" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="408.05,549.1358,417.1616,545.397,411.5061,545.5226,411.3804,539.8672,408.05,549.1358" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="459" y="515.4129">timeout</text><!--MD5=[6976270180b22ae2801cf66b4691f002]
link READY to READY--><path d="M356.53,912.4358 C376.23,912.9958 391.5,918.3558 391.5,928.5158 C391.5,937.7258 378.96,942.9858 361.94,944.3058 " fill="none" id="READY-&gt;READY" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="356.53,944.5958,365.7241,948.127,361.5234,944.3383,365.312,940.1376,356.53,944.5958" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="397.5" y="933.9129">poll 1s</text><!--MD5=[3311d6527ec48d60f0cb55f355c7386e]
link READY to UPLOAD--><path d="M289,976.8058 C289,1000.0458 289,1027.8258 289,1050.3958 " fill="none" id="READY-&gt;UPLOAD" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="289,1055.4258,293,1046.4258,289,1050.4258,285,1046.4258,289,1055.4258" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="290" y="1021.4129">.request found</text><!--MD5=[dc3d24aea14fd40af192406703930692]
link UPLOAD to REBOOT--><path d="M307.84,1132.6858 C319.06,1155.1458 333.34,1183.7058 344.94,1206.8958 " fill="none" id="UPLOAD-&gt;REBOOT" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="347.22,1211.4658,346.7602,1201.6277,344.9782,1206.9966,339.6094,1205.2146,347.22,1211.4658" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="333" y="1177.4129">success</text><!--MD5=[2f13d2c0c03c6a06948c0f238a8ac333]
link UPLOAD to FAILED--><path d="M288.28,1132.5258 C286.62,1218.5258 282.57,1429.5058 280.82,1520.3058 " fill="none" id="UPLOAD-&gt;FAILED" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="280.72,1525.3258,284.8992,1516.4076,280.82,1520.3268,276.9008,1516.2477,280.72,1525.3258" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="30" x="285" y="1333.4129">error</text><!--MD5=[f9f28ae1f20280e4f2562531dcd28016]
link REBOOT to PANIC_BOOT--><path d="M367.22,1288.6858 C367.95,1310.9558 368.86,1339.2258 369.61,1362.3158 " fill="none" id="REBOOT-&gt;PANIC_BOOT" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="369.78,1367.4658,373.4953,1358.3446,369.6229,1362.4683,365.4993,1358.5959,369.78,1367.4658" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[7e74ec03a1d67cb7dcd01b851b007dbf]
link PANIC_BOOT to PANIC_WAIT--><path d="M424.56,1436.5458 C472.47,1462.9558 542.66,1501.6458 592.78,1529.2658 " fill="none" id="PANIC_BOOT-&gt;PANIC_WAIT" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="597.26,1531.7358,591.3155,1523.8833,592.8832,1529.3186,587.4479,1530.8862,597.26,1531.7358" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[676854fc35bcbbcaa3e94857fd6529b0]
link PANIC_BOOT to FAILED--><path d="M348.97,1444.7758 C335.55,1467.7858 318.38,1497.2158 304.53,1520.9658 " fill="none" id="PANIC_BOOT-&gt;FAILED" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="301.98,1525.3258,309.9818,1519.5838,304.5082,1521.0121,303.0799,1515.5386,301.98,1525.3258" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="331" y="1489.4129">timeout</text><!--MD5=[0bb2a7f720bd86131a1245d3d63b3157]
link PANIC_WAIT to FORK--><path d="M660.05,1525.2958 C664.58,1493.7758 670,1447.5858 670,1407.0158 C670,218.0158 670,218.0158 670,218.0158 C670,32.8358 449.11,148.2558 276,82.5158 C271.67,80.8758 267.23,78.9158 262.89,76.8558 " fill="none" id="PANIC_WAIT-&gt;FORK" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="258.23,74.5658,264.5491,82.1202,262.7192,76.7675,268.0718,74.9376,258.23,74.5658" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="671" y="846.4129">fault/timeout</text><!--MD5=[a1672f73aa665290be1f5ca2aecafd1b]
link FORK to RECOVERY--><path d="M201.82,68.2558 C165.46,82.4758 103.49,112.6758 75,161.5158 C41.54,218.8958 41.52,296.6858 47,350.2758 " fill="none" id="FORK-&gt;RECOVERY" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="47.55,355.3858,50.576,346.0134,47.0214,350.4139,42.6209,346.8592,47.55,355.3858" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="76" y="224.4129">1. start thread</text><!--MD5=[abb3e01d23d1578051a51d56219afd76]
link FORK to LOG_FILTER--><path d="M230,82.7358 C230,102.2658 230,130.6058 230,156.3158 " fill="none" id="FORK-&gt;LOG_FILTER" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="230,161.4158,234,152.4158,230,156.4158,226,152.4158,230,161.4158" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="231" y="127.4129">2. continue</text><!--MD5=[1a92fdea9775d12061e0f3e8861907a2]
link LOG_FILTER to COMPLETE--><path d="M227.05,276.5858 C225.68,302.9258 224.06,334.0558 222.72,359.8258 " fill="none" id="LOG_FILTER-&gt;COMPLETE" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="222.45,364.9058,226.9083,356.1238,222.7075,359.9125,218.9189,355.7118,222.45,364.9058" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[aa30ac036f264a9f0cf1eb0654e3736e]
link COMPLETE to JOIN--><path d="M220,461.4858 C220,494.8958 220,538.5658 220,567.0558 " fill="none" id="COMPLETE-&gt;JOIN" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="220,572.1958,224,563.1958,220,567.1958,216,563.1958,220,572.1958" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[43e3ad110add599e7cbd2e0cd4c948a3]
link RECOVERY to JOIN--><path d="M88.21,470.6658 C98.56,487.2258 110.83,504.8058 124,519.5158 C143.69,541.5058 170.09,562.1958 190.23,576.5758 " fill="none" id="RECOVERY-&gt;JOIN" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="194.42,579.5458,189.3763,571.0864,190.336,576.6613,184.7611,577.6209,194.42,579.5458" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[62ec0e7b53f1b05b9709e9c60496040a]
link JOIN to WAIT--><path d="M230.18,622.6358 C240.93,648.1058 258.08,688.7458 271.09,719.5858 " fill="none" id="JOIN-&gt;WAIT" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="273.15,724.4458,273.3331,714.5987,271.2046,719.8398,265.9635,717.7113,273.15,724.4458" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[f507dd8672339037536ca30f60a24d40]
link WAIT to READY--><path d="M289,801.5258 C289,823.3558 289,851.2058 289,875.1658 " fill="none" id="WAIT-&gt;READY" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="289,880.2158,293,871.2158,289,875.2158,285,871.2158,289,880.2158" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="290" y="846.4129">OK</text><!--MD5=[743acca6738bb38ea33ca065142f19f5]
link WAIT to FAILED--><path d="M336.21,780.9658 C392.19,804.4558 478,852.6758 478,927.5158 C478,927.5158 478,927.5158 478,1407.0158 C478,1476.0758 402.76,1519.2758 345.04,1542.2558 " fill="none" id="WAIT-&gt;FAILED" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="340.21,1544.1458,350.0493,1544.5798,344.8641,1542.3185,347.1255,1537.1333,340.21,1544.1458" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="479" y="1177.4129">exception</text><!--MD5=[f1179a69d01b8091edd1f3274d3f26df]
link FAILED to RECOVERY--><path d="M219.92,1548.6158 C154.18,1528.8558 58,1486.3858 58,1407.0158 C58,596.5158 58,596.5158 58,596.5158 C58,556.3458 57.75,511.2158 57.51,475.8758 " fill="none" id="FAILED-&gt;RECOVERY" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="57.47,470.7358,53.5215,479.7586,57.4986,475.7358,61.5214,479.7128,57.47,470.7358" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="59" y="1021.4129">retry</text><!--MD5=[4db484bb6703563f2c910903a2fbd6df]
link RECOVERY to MANUAL--><path d="M108.14,457.7558 C114.03,462.2358 120.06,466.5758 126,470.5158 C185.64,510.0758 259.09,547.2358 308.7,570.8058 " fill="none" id="RECOVERY-&gt;MANUAL" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="313.42,573.0458,306.9855,565.5895,308.8975,570.9134,303.5736,572.8254,313.42,573.0458" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="203" y="515.4129">failed</text><!--MD5=[c1082131a509915a9da018fba3c3e753]
@startuml autopilot_states
skinparam backgroundColor #FEFEFE
skinparam state {
    BackgroundColor #e8f4e8
    BorderColor #333333
}

title Autopilot State Machine

[*] - -> STARTUP : daemon start

state "STARTUP\n- - -\nboard.boot()\nextlinux '1'\nwait SSH" as STARTUP #cce5ff

STARTUP - -> READY : SSH prompt
STARTUP - -> MANUAL : timeout

state "READY\n- - -\n5.15.148 running\nSSH accessible" as READY #d4edda

READY - -> READY : poll 1s
READY - -> UPLOAD : .request found

state "UPLOAD\n- - -\nSCP kernel" as UPLOAD #fff3cd

UPLOAD - -> REBOOT : success
UPLOAD - -> FAILED : error

state "REBOOT\n- - -\nSSH reboot" as REBOOT #fff3cd

REBOOT - -> PANIC_BOOT

state "PANIC_BOOT\n- - -\nextlinux '2'" as PANIC_BOOT #fff3cd

PANIC_BOOT - -> PANIC_WAIT
PANIC_BOOT - -> FAILED : timeout

state "PANIC_WAIT\n- - -\nMonitor UART" as PANIC_WAIT #ffe5cc

PANIC_WAIT - -> FORK : fault/timeout

state "FORK" as FORK #333333

state "RECOVERY\n(thread)\n- - -\nboard.boot()\nwait SSH" as RECOVERY #cce5ff

state "LOG_FILTER\n(main)\n- - -\nfilter scripts\ndisassembly" as LOG_FILTER #e2d5f1

FORK - -> RECOVERY : 1. start thread
FORK - -> LOG_FILTER : 2. continue

state "COMPLETE\n- - -\nMove to completed/\nResults ready!" as COMPLETE #d4edda

LOG_FILTER - -> COMPLETE

state "JOIN" as JOIN #333333

COMPLETE - -> JOIN
RECOVERY - -> JOIN

state "WAIT\n- - -\njoin thread" as WAIT #cce5ff

JOIN - -> WAIT

WAIT - -> READY : OK
WAIT - -> FAILED : exception

state "FAILED\n- - -\nMove to failed/" as FAILED #f8d7da

FAILED - -> RECOVERY : retry

state "MANUAL\n- - -\nIntervention\nRequired" as MANUAL #ffcccc

RECOVERY - -> MANUAL : failed

note right of FORK
  Thread starts first,
  then main continues
end note

note right of COMPLETE
  User sees results
  before recovery done
end note

note left of PANIC_WAIT
  Detects:
  panic, smmu_fault,
  nvgpu_acr_fail,
  bash_prompt, timeout
end note

@enduml

PlantUML version 1.2020.02(Sun Mar 01 12:22:07 EET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.9+10-Ubuntu-124.04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>